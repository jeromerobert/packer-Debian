#cloud-config
users:
- default
ssh_pwauth: true
#If you need to debug the vm as it is being created then it helps to add an ssh key here
#ssh_authorized_keys:
#  - <insert your ssh key here>
password: packer
chpasswd:
  expire: False
write_files:
- encoding: b64
  content: LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUVOQkdLSXRkUUJDQURXbUtUTlpFWVdnWHk3M0Z2S0ZZNWZScm80dEdOYTRCZTRUWlczd1pwY3Q5Q2o4RWp5CmtVN1M5RVBvSjNFZEtweEZsdEhSdTdRYkRpNkxXU05BNFh4d251ZFFyWUd4bnh4NlJ1MUtCSEZ4SGhMZldzdkYKY0dNd2l0L3pucHh0SXQ5VXpxQ20yWVRFVzVOVW56UTRyWFlxVlFLMkZMRzR3ZVlKNWJLd2tZK1pzblJKcHp4ZApIR0owcEJpcXdrTVQ4YmZRZEp5bVVCb3duK1NldVEySEVxZmpWTXNJUmUwZHdlRDJQSFdlV285ZlRYc3oxUTVhCmJpR2NreU9WeW9OOS8vRGdTdkxVb2NVY1pzcld2WVBhTitvOGxYVE8zR1lGR05Wc3gwNjlyeGFya2VDak9waVEKT1dyUW15d1hJU1F1ZGN1c1NnbW1nZnNSWllXN0ZEQnk1TVFyQUJFQkFBRzBVVkpoY0hSMWNtVWdRWFYwYjIxaApkR2xqSUZOcFoyNXBibWNnUzJWNUlDaGpiRzkxWkMxeVlYQjBkWEpsTFhOcFoyNXBibWN0YTJWNUxUSXdNakl0Ck1ETXRNRGN0TURoZk1ERmZNREV1Y0hWaUtZa0JJZ1FUQVFnQUZnVUNZb2kxMUFrUXRUM0lEUlB0N3dVQ0d3TUMKR1FFQUFNR29CLzk4UUJOSUlOM1EyRDNhYWhyZmtiNmF4ZDU1ek93UjB0bnJpdUpSb1BIb051b3JPcEN2OWFXTQpNdlFBQ05Xa3hzdkp4RUY4T1ViemhTWWpBUjUzNFJEaWdqVGV0aksyaTJ3S0x6L2tKalpidUY0WlhNeW5DbTQwCmVWbTFYWnFVNjNVOVhSMlJ4bVhwcHlOcE1xUU85THJ6R0VuTkp1aDIzaWNhWlk2bm8xMmF4eW14Y2xlLytTQ20KZGE4b0RBZmEwaXlBMml5Zy9lVTA1YnVadjU0TUM2UkIxM1F0Uys4dk9yS0RHcjdSWXAvVll2UXpZV20rY2s2RAp2bGFWWDZWQjUxQmtMbDIzU1FrbnlaSUpCVlBtOHR0VTY1RXlycmdHMWpMTEhGWERVcUovUnBOS3ErUEN6V2l5CnQ0dXkzQWZYSzg5UmN6THUzdXhpRDBDUUkwVDMxdS9JdVFFTkJHS0l0ZFFCQ0FESU1NSmRSY2cwUGh2NytDcloKejN4UkU4RmJ6OEFOK1lDTGlnUWVIMEI5bGlqeGtqQUZyK3RoQjBJck91N3J1d05ZK212ZFA2ZEFld1V1citwSgphSWpFZSs0czhKQkVGYjRCeEpmQkJQdUViR1N4Ymk0T1BFSnV3VDUzVE1KTUVzNytnSXhDQ213aW9UZ2dUQnA2Ckp6RHNUL2NkQmV5V0N1c0NRd0RXcHFvWUNvVVdKTHJVUTZkT2xJN3M2cCtpSVVOSWFtdHlCQ3diNGl6czI3SGQKRXBYOGd2TzlyRWR0Y2I3Mzk5SHlPM29ENGdIZ2N1Rml1WlRwdldIZG45V1l3UEdNNm5wSk5HN2NydExuY3RUUgowY1A5S3V0U1BOenB5U2VBbmlIeDhMOWViZEQ5dE5QQ1dDK090T2NHUnJjQmVFem5rWWgxQzRremRQMU9SbTV1CnBua25BQkVCQUFHSkFSOEVHQUVJQUJNRkFtS0l0ZFFKRUxVOXlBMFQ3ZThGQWhzTUFBQkptQWdBaFJQay9kRmoKNzFiVS9VVFhya0VrWlp6RTlKelVnYW4vdHR5UnJWNlFiRlpBQkJ5ZjRwWWpCait5TEt3MzI4MC8vSld1cktveAoydXpFcTFoZFhQZWRSSElDUnVoMUZqZDAwb3RhUSt3R0Yza1k3NHpsV2l2QjZXcDZ0bkw5U1RRMW9WWUJVdjdICmhTSG9KNXNoRUx5ZWR4eEh4dXJVZ0ZBRCtwYkZYSWlLOGNuQUhmWFRKTWNybVBwQytZV0VDL0RlcUl5RWNOUGsKelJodFJTdUVSWGNxMW4rS0p2TVVBS01EL3Rlend2dWp6QmFhU1dhcG1kbkdtdFJqakw3SXhVZUdhbVZXT3dMUQpiVXIrMzRNd3pkZUpkY0w4ZmF2NUxBOFVrMHVseWVYZHdpQUs4RktRc2l4SSt4WnZ6N0hVczhsbjRwWndHdy9UCnB2TzljTWtIb2d0Z3paa0JEUVJna2JlekFRZ0E1R0NSeDBFS0MrclNxMXZ5MjVuMGZaWTgrNG05bWxwNk9DVHQKMVNrTHk4SThsREQ2YXYwbDF6RHA4ZkkxOElGb3M2VDhVR0EwU2RFa0YwdlZDeWRZVjBTL3pvREoyUUdMMkEzbApkb3daeXJBQ0JIWWh2M3RhcHZEK0Z2YXFWaVhQb1RhdXhUazlkMGN4bGtjZWUwblMxa2w2TkNubU4vSy9aYjQ0Cnpway8zTGpuSm84SlEwL1YySC8wVWp2c2lmd0xNakhRSy9tV3cza0ZIZlIyQ1lqM1NOT0pSbWhqTk5qSXd6SjgKZnBxSjNQc3VlTGZtZnE4dFZyVUhjNkVMZlhSNVNENVZkYlVmc1ZlUXh4N0hvd21jYnZVMXM4MHBTK2NId1FYaApNKzBmemlNNHJ4aWFWa0hTYzNmdGtBMTBrWVBhdGwyRmorV1ZiVW9JMVZTWXpaVyttUUFSQVFBQnRGUkJjblJwClptRmpkQ0JTWldkcGMzUnllU0JTWlhCdmMybDBiM0o1SUZOcFoyNWxjaUE4WVhKMGFXWmhZM1F0Y21WbmFYTjAKY25rdGNtVndiM05wZEc5eWVTMXphV2R1WlhKQVoyOXZaMnhsTG1OdmJUNkpBVTRFRXdFS0FEZ1dJUVExdXFDegpQcDZ6bHZXY3FEakF1bHptM0dNVm93VUNZSkczc3dJYkF3VUxDUWdIQWdZVkNna0lDd0lFRmdJREFRSWVBUUlYCmdBQUtDUkRBdWx6bTNHTVZvL29vQ0FEQlllZzZ3R0RIcXZiRzJkV1J1cUFESzRwMUlYaGtHeEtudStweUEwRGIKR1o0UThHZHNGcW9GUXV3NERqS3BZVUpqcHM1dXpPamM1cXRuYno4S3Q4UXRqbmlQWDBNczQwKzluWGdVOHl6Kwp6eWFKUFR5UlRqSFMzeUMwckZKNWpMSVhrTGVBMUR0STJBRjlpbExsamlGMXlXbWQ5ZlVNcUVUUVQyR3Vhcys2CmwwdThCeXptUFBTQTZueDdlZ0xuZkJFZWM0Y2pzb2NyWEdESG1oZ3RZTlNDbHBvSHNKNFJLdE5oV3A3VENScFoKcGhZdG5nTkJEdzlOaGd0KytOa0Jxa2NTOEkxckp1ZjA2Y3JsTnVCR0NrUmdrWnUwSFZTS043b0JVbnJTcTU5Rwo4anNWaGdiN2J1SHgvRjFyMlpFVS9ydnNzeDliT2NoV0Fhbk5pVTY2eWIwVgo9VUw4WAotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg==
  owner: root:root
  path: /etc/apt/keyrings/kubernetes-archive-keyring.gpg.asc
  permissions: '0644'
- encoding: b64
  content: dmVyc2lvbiA9IDIKW3BsdWdpbnNdCiAgW3BsdWdpbnMuImlvLmNvbnRhaW5lcmQuZ3JwYy52MS5jcmkiXQogICBbcGx1Z2lucy4iaW8uY29udGFpbmVyZC5ncnBjLnYxLmNyaSIuY29udGFpbmVyZF0KICAgICAgW3BsdWdpbnMuImlvLmNvbnRhaW5lcmQuZ3JwYy52MS5jcmkiLmNvbnRhaW5lcmQucnVudGltZXNdCiAgICAgICAgW3BsdWdpbnMuImlvLmNvbnRhaW5lcmQuZ3JwYy52MS5jcmkiLmNvbnRhaW5lcmQucnVudGltZXMucnVuY10KICAgICAgICAgIHJ1bnRpbWVfdHlwZSA9ICJpby5jb250YWluZXJkLnJ1bmMudjIiCiAgICAgICAgICBbcGx1Z2lucy4iaW8uY29udGFpbmVyZC5ncnBjLnYxLmNyaSIuY29udGFpbmVyZC5ydW50aW1lcy5ydW5jLm9wdGlvbnNdCiAgICAgICAgICAgIFN5c3RlbWRDZ3JvdXAgPSB0cnVlCg==
  path: /etc/containerd/config.toml
  permissions: '0644'
- encoding: b64
  content: YnJfbmV0ZmlsdGVyCg==
  # Needed to allow kubeadm to not complain on initialization
  path: /etc/modules-load.d/netfilter.conf
  permissions: '0644'
- encoding: b64
  content: bmV0LmlwdjQuaXBfZm9yd2FyZD0xCg==
  # Needed to allow the node to forward traffic to other nodes
  path: /etc/sysctl.d/ipforward.conf
  permissions: '0644'
apt:
  sources:
    kubernetes:
      source: deb [signed-by=/etc/apt/keyrings/kubernetes-archive-keyring.gpg.asc] https://apt.kubernetes.io/ kubernetes-xenial main
packages:
- curl
- containerd
- man-db
- kubectl=${kubernetes_version}
- kubelet=${kubernetes_version}
- kubeadm=${kubernetes_version}
- jq
- vim-nox
- qemu-guest-agent
package_update: true
package_upgrade: true
