#cloud-config
users:
- default
ssh_pwauth: true
#If you need to debug the vm as it is being created then it helps to add an ssh key here
#ssh_authorized_keys:
#  - <insert your ssh key here>
password: packer
chpasswd:
  expire: False
write_files:
- encoding: b64
  content: LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tClZlcnNpb246IEdudVBHIHYyLjAuMTUgKEdOVS9MaW51eCkKCm1RRU5CR01Ib1hjQkNBRHVrR09FUXlsZVZpT2d0a01WYTdoS2lmUDZQT0NUaCs5OHhOVzRUZkhLL25CSk4yc20KdTRYYWlVbXRCOVV1R3Q5amw4VnhRZzRoT01SZjQwY29Jd0hzTnd0U3JjMlI5djVLZ3B2Y3Y1MzdRVklpZ1ZISApXTU52WGVvWmtrb0RJVWxqdmJDRURXYUVoUzlSNU9NWUtkNEFhSitmMWM4T0VMaEVjVjJkQVFMTHlqdG5FYUYvCnFtUkVOKzNZOSs1VmNSWnZRSGV5QnhDRytoZFVHRTc0MGl4Z25ZMmdTcVovSjRZZVFudFE2cE1VRWhUNnBiYUUKMTBxMkhVaWVyai9pbTBWK1pVZENoNDZMay9SZGZhNVpLbHFZT2lBMmlOMWNvRFBJZHlxS2F2Y2RmUHFTcmFLRgpMYW4yS0xjWmNnVHhQKzArSGZ6S2VmdkdFblphMTFjaXZiZTlBQkVCQUFHMFBtbHpkanByZFdKbGNtNWxkR1Z6CklFOUNVeUJRY205cVpXTjBJRHhwYzNZNmEzVmlaWEp1WlhSbGMwQmlkV2xzWkM1dmNHVnVjM1Z6WlM1dmNtYysKaVFFK0JCTUJDQUFvQlFKakI2RjNBaHNEQlFrRUhyQUFCZ3NKQ0FjREFnWVZDQUlKQ2dzRUZnSURBUUllQVFJWApnQUFLQ1JBalJsVGFtaWxrTmhuUkNBRHVkOWl2KzJDVXRKR3laaGhkenpkNTV3Ukt2SEdtU1k0ZUlBRUtDaG1mCjErQkh3Rm56QnpiZE50bmdsWTJ4U0FUcUtJV2lrelhJMXN0QXdpOHFSMGRLMzJDUytvZk1TNk9Va2xtMjZZZDEKakJXRmc0TENDaDhTMjFHTGN1dWRIdFc5UU5DQ2psQnlTNGd5RUorZVlUT28yZFdwODhOV0V6VlhJS1J0ZkxIVgpteUhKbnQyUUxtV09lWVRnbUN6cGVUOG9ubDJMcDE5YnJ5UkdsYStNczBBbWxDbHRQbjhqK2hQZUFERHRSMmJ2CjdjVExEaS9uQTQ2dTNTTFYxUDZ5akMxZWpPT3N3dGd4cHBUeHZMZ1luaVMyMmFTbm9xbTQ3bDExMXpaaVpLSjUKYkNtMVRoNnFKRkp3T3JHRU91M2FWMWlLYVFtTjJrNEcyRGl4c0hGQVUzWmVpUUljQkJNQkFnQUdCUUpqQjZGMwpBQW9KRU04TGtvemUxazg3M1RRUC8wdDJGL2psdExSUU1HN1ZDTHc3K3BzNUpDVzVGSXF1L1MyaTlnU2ROQTBFCjQydStMeXhqRzNZeG1Wb1ZSTXN4ZXU0a0VyeHI4YkxjQTRwNzFXL25LZXF3RjlWTHVYS2lyc0JDN3oyc3lGaUwKTmRsMEFSbkMzRU53dU1WbFNDd0pPME1NNU5pSnVMT3FPR1l5RDFYelNmbkN6a1hOMEpHQS9iZlBSUzVtUGZvVwowT0hJUlpGaHFFN0VENnd5V3BISUtUOHJYa0VTRndzelV3Vy9EN28xSGFnWDcrZHVMdDhXa3JvaEdieFRKMjE1Cllhbk9LU3F5S2QrNllHekROVW9HdU1OUFpKNXdUclRoT2tUekVGWjRIam1RMTZ3NXhtY1VJU25DWmQ0bmhzYlMKcU4vVXlWOVZ1M2xua2F1dFMxNUU0Q2NqUDFSUnpTa1QwamthNjJ2UHRBencrUGlHcnlNMUY3c3Z1UmFFbkpENQpHWHpqOVJDVWFSNnZ0RlZ2cXFvNGZ2YkE5OWs0WFhqK2RGQVhXMFRSWi9nMlFNZVBXOWNkV2llbGNyK3ZIRjRaCjJFbnNBbWR2RjdyNWUySkNPVTNOOE9Vb2RlYlU2d3M0VmdSVkc5Z3B0UWdmTVIwdmNpQmJOREcyWHVrMVdEazEKcXRzY2JmbTVGVkwzNm83ZGtqQTB4K1RZQ3RxWklyNHgzbW1mQVlGVXF6eHBmeVhiU0hxVUpSMkNvV3hseXo3MgpYbko3VUVvLzBVYmd6R3pzY3hMUER5SkhNTTVEbi9OaTlGVlRWS2xBTEhuRk9ZWVNUbHVvWUFDRjFETXQ3TkozCm95QTBNRUxMMEpRekVpbml4cXhwWjF0YU9tVlIvOHBRVnJxc3Rxd3FzcDNSQUJhZVo4MEpiaWdVQzI5ekpVVmYKPUY0RVgKLS0tLS1FTkQgUEdQIFBVQkxJQyBLRVkgQkxPQ0stLS0tLQo=
  owner: root:root
  path: /etc/apt/keyrings/kubernetes-apt-keyring.gpg.asc
  permissions: '0644'
- encoding: b64
  content: dmVyc2lvbiA9IDIKW3BsdWdpbnNdCiAgW3BsdWdpbnMuImlvLmNvbnRhaW5lcmQuZ3JwYy52MS5jcmkiXQogICBbcGx1Z2lucy4iaW8uY29udGFpbmVyZC5ncnBjLnYxLmNyaSIuY29udGFpbmVyZF0KICAgICAgW3BsdWdpbnMuImlvLmNvbnRhaW5lcmQuZ3JwYy52MS5jcmkiLmNvbnRhaW5lcmQucnVudGltZXNdCiAgICAgICAgW3BsdWdpbnMuImlvLmNvbnRhaW5lcmQuZ3JwYy52MS5jcmkiLmNvbnRhaW5lcmQucnVudGltZXMucnVuY10KICAgICAgICAgIHJ1bnRpbWVfdHlwZSA9ICJpby5jb250YWluZXJkLnJ1bmMudjIiCiAgICAgICAgICBbcGx1Z2lucy4iaW8uY29udGFpbmVyZC5ncnBjLnYxLmNyaSIuY29udGFpbmVyZC5ydW50aW1lcy5ydW5jLm9wdGlvbnNdCiAgICAgICAgICAgIFN5c3RlbWRDZ3JvdXAgPSB0cnVlCg==
  path: /etc/containerd/config.toml
  permissions: '0644'
- encoding: b64
  content: YnJfbmV0ZmlsdGVyCg==
  # Needed to allow kubeadm to not complain on initialization
  path: /etc/modules-load.d/netfilter.conf
  permissions: '0644'
- encoding: b64
  content: bmV0LmlwdjQuaXBfZm9yd2FyZD0xCg==
  # Needed to allow the node to forward traffic to other nodes
  path: /etc/sysctl.d/ipforward.conf
  permissions: '0644'
- encoding: b64
  content: S1VCRUxFVF9FWFRSQV9BUkdTPS0tY2xvdWQtcHJvdmlkZXI9ZXh0ZXJuYWwK
  # Needed to use an external cloud manager provider
  path: /etc/default/kubelet
  permissions: '0644'
apt:
  sources:
    kubernetes:
      source: deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg.asc] https://pkgs.k8s.io/core:/stable:/v${kubernetes_major}.${kubernetes_minor}/deb/ /
packages:
- curl
- containerd
- man-db
- kubectl
- kubelet
- kubeadm
- jq
- vim-nox
- qemu-guest-agent
package_update: true
package_upgrade: true
